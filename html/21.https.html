<!DOCTYPE html><html lang="en"><head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>珠峰架构师成长计划</title>
    <link rel="stylesheet" type="text/css" href="../static/css/main.css">
</head>
<body>
<div class="nav">
    <div class="logo">
        
            珠峰架构师成长计划
        
    </div>
<ul><li><a href="../index.html">0.Async</a></li><li><a href="../html/0.editor.html">0.editor</a></li><li><a href="../html/0.module.html">0.module</a></li><li><a href="../html/1.ES2015.html">1.ES2015</a></li><li><a href="../html/2.Promise.html">2.Promise</a></li><li><a href="../html/3.Node.html">3.Node</a></li><li><a href="../html/4.NodeInstall.html">4.NodeInstall</a></li><li><a href="../html/5.REPL.html">5.REPL</a></li><li><a href="../html/6.NodeCore.html">6.NodeCore</a></li><li><a href="../html/7.module&amp;NPM.html">7.module&amp;NPM</a></li><li><a href="../html/8.Encoding.html">8.Encoding</a></li><li><a href="../html/9.Buffer.html">9.Buffer</a></li><li><a href="../html/10.fs.html">10.fs</a></li><li><a href="../html/11.Stream-1.html">11.Stream-1</a></li><li><a href="../html/11.Stream-2.html">11.Stream-2</a></li><li><a href="../html/11.Stream-3.html">11.Stream-3</a></li><li><a href="../html/11.Stream-4.html">11.Stream-4</a></li><li><a href="../html/12-Network-2.html">12-Network-2</a></li><li><a href="../html/12.NetWork-3.html">12.NetWork-3</a></li><li><a href="../html/12.Network-1.html">12.Network-1</a></li><li><a href="../html/13.tcp.html">13.tcp</a></li><li><a href="../html/14.http-1.html">14.http-1</a></li><li><a href="../html/14.http-2.html">14.http-2</a></li><li><a href="../html/15.compress.html">15.compress</a></li><li><a href="../html/16.crypto.html">16.crypto</a></li><li><a href="../html/17.process.html">17.process</a></li><li><a href="../html/18.yargs.html">18.yargs</a></li><li><a href="../html/19.cache.html">19.cache</a></li><li><a href="../html/20.action.html">20.action</a></li><li class="active"><a href="../html/21.https.html">21.https</a></li><li><a href="../html/22.cookie.html">22.cookie</a></li><li><a href="../html/23.session.html">23.session</a></li><li><a href="../html/24.express-1.html">24.express-1</a></li><li><a href="../html/24.express-2.html">24.express-2</a></li><li><a href="../html/24.express-3.html">24.express-3</a></li><li><a href="../html/24.express-4.html">24.express-4</a></li><li><a href="../html/25.koa-1.html">25.koa-1</a></li><li><a href="../html/26.webpack-1-basic.html">26.webpack-1-basic</a></li><li><a href="../html/26.webpack-2-optimize.html">26.webpack-2-optimize</a></li><li><a href="../html/26.webpack-3.tapable.html">26.webpack-3.tapable</a></li><li><a href="../html/26.webpack-4-AST.html">26.webpack-4-AST</a></li><li><a href="../html/26.webpack-5-source.html">26.webpack-5-source</a></li><li><a href="../html/26.webpack-6-loader.html">26.webpack-6-loader</a></li><li><a href="../html/26.webpack-7-plugin.html">26.webpack-7-plugin</a></li><li><a href="../html/26.webpack-8-hand.html">26.webpack-8-hand</a></li><li><a href="../html/27.react-1.html">27.react-1</a></li><li><a href="../html/27.react-2.html">27.react-2</a></li><li><a href="../html/27.react-3.html">27.react-3</a></li><li><a href="../html/27.react-4-immutable.html">27.react-4-immutable</a></li><li><a href="../html/27.react-5-react-dom-diff.html">27.react-5-react-dom-diff</a></li><li><a href="../html/27.react-6.html">27.react-6</a></li><li><a href="../html/28.react-mobx.html">28.react-mobx</a></li><li><a href="../html/28.redux-0.html">28.redux-0</a></li><li><a href="../html/28.redux-1.html">28.redux-1</a></li><li><a href="../html/28.redux-2-中间件.html">28.redux-2-中间件</a></li><li><a href="../html/28.redux-jwt-back.html">28.redux-jwt-back</a></li><li><a href="../html/28.redux-jwt-front.html">28.redux-jwt-front</a></li><li><a href="../html/29.mongodb-1.html">29.mongodb-1</a></li><li><a href="../html/29.mongodb-2.html">29.mongodb-2</a></li><li><a href="../html/29.mongodb-3.html">29.mongodb-3</a></li><li><a href="../html/29.mongodb-4.html">29.mongodb-4</a></li><li><a href="../html/29.mongodb-5.html">29.mongodb-5</a></li><li><a href="../html/29.mongodb-6.html">29.mongodb-6</a></li><li><a href="../html/30.cms-1-mysql.html">30.cms-1-mysql</a></li><li><a href="../html/30.cms-2-mysql.html">30.cms-2-mysql</a></li><li><a href="../html/30.cms-3-mysql.html">30.cms-3-mysql</a></li><li><a href="../html/30.cms-4-nunjucks.html">30.cms-4-nunjucks</a></li><li><a href="../html/30.cms-5-mock.html">30.cms-5-mock</a></li><li><a href="../html/30.cms-6-egg.html">30.cms-6-egg</a></li><li><a href="../html/30.cms-7-api.html">30.cms-7-api</a></li><li><a href="../html/30.cms-8-roadhog.html">30.cms-8-roadhog</a></li><li><a href="../html/30.cms-9-yaml.html">30.cms-9-yaml</a></li><li><a href="../html/30.cms-10-umi.html">30.cms-10-umi</a></li><li><a href="../html/30.cms-11-saga.html">30.cms-11-saga</a></li><li><a href="../html/30.cms-12-dva.html">30.cms-12-dva</a></li><li><a href="../html/30.cms-13-dva-ant.html">30.cms-13-dva-ant</a></li><li><a href="../html/30.cms-14-front.html">30.cms-14-front</a></li><li><a href="../html/30.cms-15-deploy.html">30.cms-15-deploy</a></li><li><a href="../html/31.dva.html">31.dva</a></li><li><a href="../html/33.redis.html">33.redis</a></li><li><a href="../html/34.unittest.html">34.unittest</a></li><li><a href="../html/35.jwt.html">35.jwt</a></li><li><a href="../html/36.websocket-1.html">36.websocket-1</a></li><li><a href="../html/36.websocket-2.html">36.websocket-2</a></li><li><a href="../html/38.chat-api-1.html">38.chat-api-1</a></li><li><a href="../html/38.chat-api-2.html">38.chat-api-2</a></li><li><a href="../html/38.chat-3.html">38.chat-3</a></li><li><a href="../html/38.chat-api-3.html">38.chat-api-3</a></li><li><a href="../html/38.chat.html">38.chat</a></li><li><a href="../html/38.chat2.html">38.chat2</a></li><li><a href="../html/38.chat2.html">38.chat2</a></li><li><a href="../html/39.crawl-0.html">39.crawl-0</a></li><li><a href="../html/39.crawl-1.html">39.crawl-1</a></li><li><a href="../html/39.crawl-2.html">39.crawl-2</a></li><li><a href="../html/40.deploy.html">40.deploy</a></li><li><a href="../html/41.safe.html">41.safe</a></li><li><a href="../html/42.test.html">42.test</a></li><li><a href="../html/43.nginx.html">43.nginx</a></li><li><a href="../html/44.enzyme.html">44.enzyme</a></li><li><a href="../html/45.docker.html">45.docker</a></li><li><a href="../html/46.elastic.html">46.elastic</a></li><li><a href="../html/47.oauth.html">47.oauth</a></li><li><a href="../html/48.wxpay.html">48.wxpay</a></li><li><a href="../html/index.html">index</a></li><li><a href="../html/51.typescript.html">51.typescript</a></li><li><a href="../html/52.UML.html">52.UML</a></li><li><a href="../html/53.design.html">53.design</a></li><li><a href="../html/index.html">index</a></li><li><a href="../html/54.linux.html">54.linux</a></li><li><a href="../html/57.ts.html">57.ts</a></li><li><a href="../html/56.react-ssr.html">56.react-ssr</a></li><li><a href="../html/58.ts_react.html">58.ts_react</a></li><li><a href="../html/59.ketang.html">59.ketang</a></li><li><a href="../html/59.ketang2.html">59.ketang2</a></li><li><a href="../html/31.saga.html">31.saga</a></li></ul></div>


<div class="warpper">

    <div class="page-toc">
        <ul><li><a href="#t01. http通信有什么问题?">1. http通信有什么问题?</a><ul><li><a href="#t11.1 可能被窃听">1.1 可能被窃听</a></li><li><a href="#t21.2 认证问题">1.2 认证问题</a></li><li><a href="#t31.3 可能被篡改">1.3 可能被篡改</a></li></ul></li><li><a href="#t42. HTTPS如何解决上述三个问题?">2. HTTPS如何解决上述三个问题?</a></li><li><a href="#t53. SSL 和 TLS 的区别">3. SSL 和 TLS 的区别</a></li><li><a href="#t63. SSL 协议">3. SSL 协议</a><ul><li><a href="#t73.1 对称加密">3.1 对称加密</a></li><li><a href="#t83.2 非对称加密技术">3.2 非对称加密技术</a></li><li><a href="#t93.3 完整性验证算法">3.3 完整性验证算法</a></li><li><a href="#t103.4 工作方式">3.4 工作方式</a></li><li><a href="#t113.5 SSL协议构成">3.5 SSL协议构成</a></li></ul></li><li><a href="#t123.6 HTTPS协议改进过程">3.6 HTTPS协议改进过程</a><ul><li><a href="#t133.6.1 针对窃听风险">3.6.1 针对窃听风险</a></li></ul></li><li><a href="#t143.6.2 安全传递密钥">3.6.2 安全传递密钥</a><ul><li><a href="#t153.6 SSL密钥协商的过程如下">3.6 SSL密钥协商的过程如下</a><ul><li><a href="#t163.6.1. client_hello过程">3.6.1. client_hello过程</a></li><li><a href="#t173.6.2. server_hello 过程">3.6.2. server_hello 过程</a></li><li><a href="#t183.6.3. 证书校验，协商最后通信密钥">3.6.3. 证书校验，协商最后通信密钥</a></li><li><a href="#t193.6.4. 验证协商密钥">3.6.4. 验证协商密钥</a></li><li><a href="#t203.6.5 HTTPS完整建立连接过程,如下图">3.6.5 HTTPS完整建立连接过程,如下图</a></li></ul></li></ul></li><li><a href="#t213.7 证书">3.7 证书</a><ul><li><a href="#t223.7.1 申请和发放证书流程如下">3.7.1 申请和发放证书流程如下</a></li><li><a href="#t233.7.2 证书链">3.7.2 证书链</a></li></ul></li><li><a href="#t242. https服务器">2. https服务器</a><ul><li><a href="#t252.1 创建私钥">2.1 创建私钥</a></li><li><a href="#t262.2 创建证书签名请求">2.2 创建证书签名请求</a></li><li><a href="#t272.3 获取证书，线上证书需要经过证书授证中心签名的文件；下面只创建一个学习使用证书">2.3 获取证书，线上证书需要经过证书授证中心签名的文件；下面只创建一个学习使用证书</a></li><li><a href="#t282.4 创建pfx文件">2.4 创建pfx文件</a></li><li><a href="#t292.5 创建服务器">2.5 创建服务器</a></li><li><a href="#t302.6 创建HTTPS客户端">2.6 创建HTTPS客户端</a></li></ul></li><li><a href="#t313.8 让你的网站支持https">3.8 让你的网站支持https</a></li></ul>
    </div>
    
    <div class="content markdown-body">
        <h2 id="t01. http通信有什么问题?">1. http通信有什么问题? <a href="#t01. http通信有什么问题?"> # </a></h2>
<ul>
<li>窃听 - 对称加密</li>
<li>传递密钥 - 非对称加密</li>
<li>安全速度 - 非对称加密+对称加密</li>
<li>中间人攻击 - 证书</li>
<li>证书伪造 - 消息摘要</li>
<li>摘要伪造 - 数字签名</li>
</ul>
<h3 id="t11.1 可能被窃听">1.1 可能被窃听 <a href="#t11.1 可能被窃听"> # </a></h3>
<ul>
<li>HTTP 本身不具备加密的功能,HTTP 报文使用明文方式发送</li>
<li><p>由于互联网是由联通世界各个地方的网络设施组成,所有发送和接收经过某些设备的数据都可能被截获或窥视。(例如大家都熟悉的抓包工具:Wireshark),即使经过加密处理,也会被窥视是通信内容,只是可能很难或者无法破解出报文的信息而已</p>
<p><img src="http://img.zhufengpeixun.cn/sniff.png" alt=""></p>
</li>
</ul>
<h3 id="t21.2 认证问题">1.2 认证问题 <a href="#t21.2 认证问题"> # </a></h3>
<ul>
<li>无法确认你发送到的服务器就是真正的目标服务器(可能服务器是伪装的)</li>
<li>无法确定返回的客户端是否是按照真实意图接收的客户端(可能是伪装的客户端)</li>
<li>无法确定正在通信的对方是否具备访问权限,Web 服务器上某些重要的信息，只想发给特定用户即使是无意义的请求也会照单全收。无法阻止海量请求下的 DoS 攻击（Denial of Service，拒绝服务攻击）。<h3 id="t31.3 可能被篡改">1.3 可能被篡改 <a href="#t31.3 可能被篡改"> # </a></h3>
请求或响应在传输途中，遭攻击者拦截并篡改内容的攻击被称为中间人攻击（Man-in-the-Middle attack，MITM）。</li>
</ul>
<h2 id="t42. HTTPS如何解决上述三个问题?">2. HTTPS如何解决上述三个问题? <a href="#t42. HTTPS如何解决上述三个问题?"> # </a></h2>
<p>HTTPS是在通信接口部分用 TLS(Transport Layer Security)协议。</p>
<p><img src="http://img.zhufengpeixun.cn/https1.png" alt=""></p>
<h2 id="t53. SSL 和 TLS 的区别">3. SSL 和 TLS 的区别 <a href="#t53. SSL 和 TLS 的区别"> # </a></h2>
<ul>
<li>传输层安全性协议（英语：Transport Layer Security，缩写作 TLS），及其前身安全套接层（Secure Sockets Layer，缩写作 SSL）是一种安全协议，目的是为互联网通信，提供安全及数据完整性保障。</li>
<li>网景公司（Netscape）在1994年推出首版网页浏览器，网景导航者时，推出HTTPS协议，以SSL进行加密，这是SSL的起源。</li>
<li>IETF将SSL进行标准化，1999年公布第一版TLS标准文件。随后又公布RFC 5246 （2008年8月）与 RFC 6176 （2011年3月）。以下就简称SSL</li>
<li>TLS是SSL的标准. HTTPS 就是 HTTP + SSL</li>
</ul>
<p><img src="http://img.zhufengpeixun.cn/https_http.png" alt=""></p>
<h2 id="t63. SSL 协议">3. SSL 协议 <a href="#t63. SSL 协议"> # </a></h2>
<p>HTTPS 协议的主要功能基本都依赖于 TLS/SSL 协议，TLS/SSL 的功能实现主要依赖于三类基本算法：散列函数 、对称加密和非对称加密，其利用非对称加密实现身份认证和密钥协商，对称加密算法采用协商的密钥对数据加密，基于散列函数验证信息的完整性。</p>
<p><img src="http://img.zhufengpeixun.cn/tls_ssl.png" alt=""></p>
<h3 id="t73.1 对称加密">3.1 对称加密 <a href="#t73.1 对称加密"> # </a></h3>
<ul>
<li>常见的有 AES-CBC、DES、3DES、AES-GCM等，相同的密钥可以用于信息的加密和解密，掌握密钥才能获取信息，能够防止信息窃听，通信方式是1对1；</li>
<li>对称加密需要共享相同的密码，密码的安全是保证信息安全的基础，服务器和多 个客户端通信，需要维持多个密码记录，且缺少修改密码的机制；</li>
<li>优点：算法公开、计算量小、加密速度快、加密效率高。</li>
<li>缺点：交易双方都使用同样钥匙，安全性得不到保证。</li>
</ul>
<p><img src="http://img.zhufengpeixun.cn/https2.png" alt=""></p>
<h3 id="t83.2 非对称加密技术">3.2 非对称加密技术 <a href="#t83.2 非对称加密技术"> # </a></h3>
<ul>
<li>即常见的 RSA 算法，还包括 ECC、DH 等算法，算法特点是，密钥成对出现，一般称为公钥(公开)和私钥(保密)，公钥加密的信息只能私钥解开，私钥加密的信息只能公钥解开。因此掌握公钥的不同客户端之间不能互相解密信息，只能和掌握私钥的服务器进行加密通信，服务器可以实现1对多的通信，客户端也可以用来验证掌握私钥的服务器身份。</li>
<li>非对称加密的特点是信息传输一对多，服务器只需要维持一个私钥就能够和多个客户端进行加密通信，但服务器发出的信息能够被所有的客户端解密，且该算法的计算复杂，加密速度慢。</li>
</ul>
<p><img src="http://img.zhufengpeixun.cn/https3.png" alt=""></p>
<h3 id="t93.3 完整性验证算法">3.3 完整性验证算法 <a href="#t93.3 完整性验证算法"> # </a></h3>
<ul>
<li>常见的有 MD5、SHA1、SHA256，该类函数特点是函数单向不可逆、对输入非常敏感、输出长度固定，针对数据的任何修改都会改变散列函数的结果，用于防止信息篡改并验证数据的完整性；</li>
<li>在信息传输过程中，散列函数不能单独实现信息防篡改，因为明文传输，中间人可以修改信息之后重新计算信息摘要，因此需要对传输的信息以及信息摘要进行加密；</li>
</ul>
<h3 id="t103.4 工作方式">3.4 工作方式 <a href="#t103.4 工作方式"> # </a></h3>
<p>结合三类算法的特点，TLS 的基本工作方式是</p>
<ul>
<li>客户端使用非对称加密与服务器进行通信，实现身份验证并协商对称加密使用的密钥</li>
<li>然后对称加密算法采用协商密钥对信息以及信息摘要进行加密通信，不同的节点之间采用的对称密钥不同，从而可以保证信息只能通信双方获取。</li>
</ul>
<h3 id="t113.5 SSL协议构成">3.5 SSL协议构成 <a href="#t113.5 SSL协议构成"> # </a></h3>
<ul>
<li>第一层是记录协议(Record Protocol), 用于定义传输格式。</li>
<li>第二层握手协议(Handshake Protocol),它建立在SSL记录协议之上,用于在实际的数据传输开始前，通讯双方进行身份认证、协商加密算法、交换加密密钥等。</li>
</ul>
<p><img src="http://img.zhufengpeixun.cn/ssltlsprotocal.png" alt=""></p>
<h2 id="t123.6 HTTPS协议改进过程">3.6 HTTPS协议改进过程 <a href="#t123.6 HTTPS协议改进过程"> # </a></h2>
<h3 id="t133.6.1 针对窃听风险">3.6.1 针对窃听风险 <a href="#t133.6.1 针对窃听风险"> # </a></h3>
<p>黑客可以嗅探通信内容
<img src="http://img.zhufengpeixun.cn/ssltlsprotocal.png" alt=""></p>
<p><img src="http://img.zhufengpeixun.cn/ssltlsprotocal.png" alt=""></p>
<p>对称加密算法的特点是加密和解密是使用同一个密钥，加解密速度快，典型的对称加密算法有DES、AES等。使用对称加密，客户端和服务端双方拥有相同的密钥，信息得到安全传输。
此种方式的缺点是：</p>
<ul>
<li>客户端、服务器双方都需要维护大量的密钥，维护成本很高；</li>
<li>因每个客户端、服务器的安全级别不同，密钥容易泄露；</li>
</ul>
<h2 id="t143.6.2 安全传递密钥">3.6.2 安全传递密钥 <a href="#t143.6.2 安全传递密钥"> # </a></h2>
<p>非对称加密算法的特点加密和解密分别使用不同的密钥, 相对来说加解密速度较慢，典型的非对称加密算法有RSA、DSA等。客户端用公钥对请求内容加密，服务器使用私钥对内容解密，反之亦然。
此种方式的缺点是：</p>
<ul>
<li>公钥是公开的，所以针对私钥加密的信息，黑客截获后可以使用公钥进行解密，获取其中的内容；</li>
<li>公钥并不包含服务器的信息，使用非对称加密算法无法确保服务器身份的合法性，存在中间人攻击的风险，服务器发送给客户端的公钥可能在传送过程中被中间人截获并篡改；</li>
<li>使用非对称加密在数据加密解密过程需要消耗一定时间，降低了数据传输效率；</li>
</ul>
<p>客户端C和服务器S进行通信，中间节点M截获了二者的通信；
节点M自己计算产生一对公钥pub_M和私钥 pri_M；
C向S请求公钥时，M把自己的公钥pub_M发给了C；
 C 使用公钥pub_M加密的数据能够被M解密，因为M掌握对应的私钥 pri_M，而 C 无法根据公钥信息判断服务器的身份，从而 C 和 M 之间建立了“可信”加密连接;
中间节点 M 和服务器S之间再建立合法的连接，因此 C 和 S 之间通信被M完全掌握，M 可以进行信息的窃听、篡改等操作。</p>
<h3 id="t153.6 SSL密钥协商的过程如下">3.6 SSL密钥协商的过程如下 <a href="#t153.6 SSL密钥协商的过程如下"> # </a></h3>
<h4 id="t163.6.1. client_hello过程">3.6.1. client_hello过程 <a href="#t163.6.1. client_hello过程"> # </a></h4>
<p>客户端发起请求，以明文传输请求信息，包含版本信息，加密套件候选列表，压缩算法候选列表，随机数，扩展字段等信息，相关信息如下：</p>
<p><img src="http://img.zhufengpeixun.cn/https_ssl.svg" alt=""></p>
<ul>
<li>版本信息: 支持的最高TSL协议版本version，从低到高依次 SSLv2 SSLv3 TLSv1 TLSv1.1 TLSv1.2，当前基本不再使用低于 TLSv1 的版本</li>
<li>加密套件候选列表(cipher suite): 认证算法 Au (身份验证)、密钥交换算法 KeyExchange(密钥协商)、对称加密算法 Enc (信息加密)和信息摘要 Mac(完整性校验);</li>
<li>压缩算法候选列表:支持的压缩算法 compression methods 列表，用于后续的信息压缩传输;</li>
<li>随机数:随机数就是上图里的RNc,用于后续生成协商密钥;</li>
<li>协商数据:支持协议与算法的相关参数以及其它辅助信息等，常见的 SNI 就属于扩展字段，后续单独讨论该字段作用。</li>
</ul>
<h4 id="t173.6.2. server_hello 过程">3.6.2. server_hello 过程 <a href="#t173.6.2. server_hello 过程"> # </a></h4>
<ul>
<li>服务端返回协商的信息结果，包括选择使用的协议版本version，选择的加密套件 cipher suite，选择的压缩算法 compression method、随机数 RNs等，其中随机数用于后续的密钥协商;</li>
<li>服务器证书链,用于身份校验和密钥交换</li>
<li>通知客户端server-hello结束,请求客户端的证书和密钥</li>
</ul>
<h4 id="t183.6.3. 证书校验，协商最后通信密钥">3.6.3. 证书校验，协商最后通信密钥 <a href="#t183.6.3. 证书校验，协商最后通信密钥"> # </a></h4>
<p>a. 客户端验证服务端证书的合法性，如果验证通过才会进行后续通信，否则根据错误情况不同做出提示和操作，合法性验证包括如下：</p>
<ul>
<li>证书链的可信性 trusted certificate path</li>
<li>证书是否吊销 revocation</li>
<li>有效期 expiry date，证书是否在有效时间范围;</li>
<li>域名 domain，核查证书域名是否与当前的访问域名匹配，匹配规则后续分析;
b. 客户端发送客户端证书,公钥服务端验证(过程同客户端验证)
c. 客户端hash所有之前的消息,发送hash值和摘要,用客户端的私钥加密发送给服务端,服务端用客户端的公钥解密,验证了服务端获取的客户端的公钥和算法是正确的
d. 客户端生成pms,用服务端的公钥加密后发送给服务端
e. 客户端和服务端同时计算出最终会话密钥(MS)</li>
</ul>
<h4 id="t193.6.4. 验证协商密钥">3.6.4. 验证协商密钥 <a href="#t193.6.4. 验证协商密钥"> # </a></h4>
<p>a. Client发送ChangeCipherSpec，指示Server从现在开始发送的消息都是加密过的
b. Client发送Finishd，包含了前面所有握手消息的hash，可以让server验证握手过程是否被第三方篡改
c. 服务端发送ChangeCipherSpec，指示Client从现在开始发送的消息都是加密过的
d. Server发送Finishd，包含了前面所有握手消息的hash，可以让client验证握手过程是否被第三方篡改，并且证明自己是Certificate密钥的拥有者，即证明自己的身份</p>
<h4 id="t203.6.5 HTTPS完整建立连接过程,如下图">3.6.5 HTTPS完整建立连接过程,如下图 <a href="#t203.6.5 HTTPS完整建立连接过程,如下图"> # </a></h4>
<ul>
<li>首先建立tcp握手连接</li>
<li>进行ssl协议的握手密钥交换(Handshake protocal)</li>
<li>然后通过共同约定的密钥开始通信</li>
</ul>
<p><img src="http://img.zhufengpeixun.cn/https_protocal.png" alt=""></p>
<h2 id="t213.7 证书">3.7 证书 <a href="#t213.7 证书"> # </a></h2>
<p>证书的作用就是,我和服务端通信,我怎么知道这个服务端是我要真正通信的服务端呢</p>
<p><img src="http://img.zhufengpeixun.cn/zhengshu_brower.png" alt=""></p>
<h3 id="t223.7.1 申请和发放证书流程如下">3.7.1 申请和发放证书流程如下 <a href="#t223.7.1 申请和发放证书流程如下"> # </a></h3>
<p><img src="http://img.zhufengpeixun.cn/zhengshu.png" alt=""></p>
<ul>
<li>服务方 Server 向第三方机构CA提交公钥、组织信息、个人信息(域名)等信息并申请认证;</li>
<li>CA通过线上、线下等多种手段验证申请者提供信息的真实性，如组织是否存在、企业是否合法，是否拥有域名的所有权等;</li>
<li>如信息审核通过，CA会向申请者签发认证文件-证书。证书包含以下信息：申请者公钥、申请者的组织信息和个人信息、签发机构 CA的信息、有效时间、证书序列号等信息的明文，同时包含一个签名; 签名的产生算法：首先，使用散列函数计算公开的明文信息的信息摘要，然后，采用 CA的私钥对信息摘要进行加密，密文即签名;</li>
<li>客户端 Client 向服务器 Server 发出请求时，Server 返回证书文件;</li>
<li>客户端 Client 读取证书中的相关的明文信息，采用相同的散列函数计算得到信息摘要，然后，利用对应 CA的公钥解密签名数据，对比证书的信息摘要，如果一致，则可以确认证书的合法性，即公钥合法;</li>
<li>客户端还会验证证书相关的域名信息、有效时间等信息; 客户端会内置信任CA的证书信息(包含公钥)，如果CA不被信任，则找不到对应 CA的证书，证书也会被判定非法。</li>
</ul>
<h3 id="t233.7.2 证书链">3.7.2 证书链 <a href="#t233.7.2 证书链"> # </a></h3>
<p><img src="http://img.zhufengpeixun.cn/zhengshulian.png" alt=""></p>
<ul>
<li>服务器证书 server.pem 的签发者为中间证书机构 inter，inter 根据证书 inter.pem 验证 server.pem 确实为自己签发的有效证书</li>
<li>中间证书 inter.pem 的签发 CA 为 root，root 根据证书 root.pem 验证 inter.pem 为自己签发的合法证书;</li>
<li>客户端内置信任 CA 的 root.pem 证书，因此服务器证书 server.pem 的被信任。</li>
<li>服务器证书、中间证书与根证书在一起组合成一条合法的证书链，证书链的验证是自下而上的信任传递的过程。</li>
</ul>
<h2 id="t242. https服务器">2. https服务器 <a href="#t242. https服务器"> # </a></h2>
<ul>
<li>HTTPS使用https协议，默认端口号443；</li>
<li>HTTPS需要向证书授证中心申请证书；</li>
<li>HTTPS服务器与客户端之间传输是经过SSL安全加密后的密文数据；
在创建HTTPS服务器之前，服务器首先需要创建公钥、私钥及证书，步骤如下
创建公钥、私钥及证书</li>
</ul>
<h3 id="t252.1 创建私钥">2.1 创建私钥 <a href="#t252.1 创建私钥"> # </a></h3>
<pre><code class="lang-js">openssl genrsa -out privatekey.pem <span class="hljs-number">1024</span>
</code></pre>
<h3 id="t262.2 创建证书签名请求">2.2 创建证书签名请求 <a href="#t262.2 创建证书签名请求"> # </a></h3>
<pre><code>openssl req -new -key privatekey.pem -out certrequest.csr
</code></pre><h3 id="t272.3 获取证书，线上证书需要经过证书授证中心签名的文件；下面只创建一个学习使用证书">2.3 获取证书，线上证书需要经过证书授证中心签名的文件；下面只创建一个学习使用证书 <a href="#t272.3 获取证书，线上证书需要经过证书授证中心签名的文件；下面只创建一个学习使用证书"> # </a></h3>
<pre><code class="lang-js">openssl x509 -req -<span class="hljs-keyword">in</span> certrequest.csr -signkey privatekey.pem -out certificate.pem
</code></pre>
<h3 id="t282.4 创建pfx文件">2.4 创建pfx文件 <a href="#t282.4 创建pfx文件"> # </a></h3>
<pre><code class="lang-js">openssl pkcs12 -<span class="hljs-keyword">export</span> -<span class="hljs-keyword">in</span> certificate.pem -inkey privatekey.pem -out certificate.pfx
</code></pre>
<h3 id="t292.5 创建服务器">2.5 创建服务器 <a href="#t292.5 创建服务器"> # </a></h3>
<p>创建HTTPS服务器同HTTP服务器大致相同，需要增加证书，创建HTTPS服务器时通过options参数设置。</p>
<pre><code class="lang-javascript">https.createServer(options,[requestListener]);
</code></pre>
<ul>
<li>pfx 私钥、公钥以及证书</li>
<li>key 私钥</li>
<li>passphrase 为私钥指定密码</li>
<li>cert 公钥</li>
<li>ca 证书，用于指定一组证书，默认属性值为几个著名的证书授权中心,例如VerlSign</li>
<li>crl 指定证书吊销主</li>
</ul>
<pre><code class="lang-javascript"><span class="hljs-keyword">import</span> https <span class="hljs-keyword">from</span> <span class="hljs-string">'https'</span>;
<span class="hljs-keyword">import</span> fs <span class="hljs-keyword">from</span> <span class="hljs-string">'fs'</span>;

<span class="hljs-keyword">var</span> pk = fs.readFileSync(<span class="hljs-string">'privatekey.pem'</span>),
    pc = fs.readFileSync(<span class="hljs-string">'certificate.pem'</span>);

<span class="hljs-keyword">var</span> opts = {
    <span class="hljs-attr">key</span>: pk,
    <span class="hljs-attr">cert</span>: pc
};

<span class="hljs-keyword">var</span> server = https.createServer(opts);
</code></pre>
<p>opts参数为一个对象，用于指定创建HTTPS服务器时配置的各种选项，下面只描述几个必要选项：</p>
<table>
<thead>
<tr>
<th style="text-align:left">属性名</th>
<th style="text-align:left">说明</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">pff</td>
<td style="text-align:left">用于指定从pfx文件读取出的私钥、公钥以及证书（指定该属性后，无需再指定key、cert、ca）</td>
</tr>
<tr>
<td style="text-align:left">key</td>
<td style="text-align:left">用于指定后缀名为pem的文件，读出私钥</td>
</tr>
<tr>
<td style="text-align:left">cert</td>
<td style="text-align:left">用于指定后缀名为pem的文件，读出公钥</td>
</tr>
<tr>
<td style="text-align:left">ca</td>
<td style="text-align:left">用于指定一组证书，默认值为几个著名的证书授证中心</td>
</tr>
</tbody>
</table>
<h3 id="t302.6 创建HTTPS客户端">2.6 创建HTTPS客户端 <a href="#t302.6 创建HTTPS客户端"> # </a></h3>
<p>在https模块中，可以使用request方法向其它使用HTTPS协议的网站请求数据</p>
<pre><code class="lang-javascript"><span class="hljs-keyword">let</span> req = https.request(options,callback);
</code></pre>
<ul>
<li>host 指定域名或目标主机的IP地址</li>
<li>hostname 指定域名或目标主机的IP地址</li>
<li>port 端口号</li>
<li>method 指定请求方法名</li>
<li>path 指下请求路径及查询字符串</li>
<li>headers 客户端请求头对象</li>
<li>auth 指定认证信息部分</li>
<li>agent 指定用户代理,指定false则从连接池中挑选一个连接状态为关闭的https.Agent对象</li>
<li>pfx 指定私钥、公钥和证书</li>
<li>key 指定私钥</li>
<li>cert 公钥</li>
<li>ca 一组证书</li>
</ul>
<pre><code class="lang-javascript"><span class="hljs-keyword">const</span> options = {
        <span class="hljs-attr">hostname</span>: <span class="hljs-string">'localhost'</span>,
        <span class="hljs-attr">port</span>: <span class="hljs-number">1443</span>,
        <span class="hljs-attr">path</span>: <span class="hljs-string">'/'</span>,
        <span class="hljs-attr">method</span>: <span class="hljs-string">'post'</span>,
        <span class="hljs-attr">key</span>: fs.readFileSync(<span class="hljs-string">'privatekey.pem'</span>),
        <span class="hljs-attr">cert</span>: fs.readFileSync(<span class="hljs-string">'certificate.pem'</span>),
        <span class="hljs-attr">rejectUnhauthorized</span>: <span class="hljs-literal">false</span>,
        <span class="hljs-attr">agent</span>: <span class="hljs-literal">false</span> <span class="hljs-comment">// 从连接池中指定挑选一个当前连接状态为关闭的https.Agent</span>
    },
    req = https.request(options);

<span class="hljs-comment">// 或者</span>
<span class="hljs-keyword">const</span> options = {
        <span class="hljs-attr">hostname</span>: <span class="hljs-string">'localhost'</span>,
        <span class="hljs-attr">port</span>: <span class="hljs-number">1443</span>,
        <span class="hljs-attr">path</span>: <span class="hljs-string">'/'</span>,
        <span class="hljs-attr">method</span>: <span class="hljs-string">'post'</span>,
        <span class="hljs-attr">key</span>: fs.readFileSync(<span class="hljs-string">'privatekey.pem'</span>),
        <span class="hljs-attr">cert</span>: fs.readFileSync(<span class="hljs-string">'certificate.pem'</span>),
        <span class="hljs-attr">rejectUnhauthorized</span>: <span class="hljs-literal">false</span>,
    };
<span class="hljs-comment">// 显示指定https.Agent对象</span>
options.agent = <span class="hljs-keyword">new</span> https.Agent(options);
<span class="hljs-keyword">var</span> req = https.request(options);
</code></pre>
<h2 id="t313.8 让你的网站支持https">3.8 让你的网站支持https <a href="#t313.8 让你的网站支持https"> # </a></h2>
<ul>
<li><a href="http://www.laozuo.org/7676.html">实战申请Let's Encrypt永久免费SSL证书过程教程及常见问题</a></li>
</ul>
<pre><code class="lang-js">git clone https:<span class="hljs-comment">//github.com/letsencrypt/letsencrypt</span>
cd letsencrypt
chmod <span class="hljs-number">777</span> ./letsencrypt-auto
./letsencrypt-auto certonly --standalone --email zhang_renyang@<span class="hljs-number">126.</span>com -d itnewhand.com

/etc/letsencrypt/live/itnewhand.com/fullchain.pem
/etc/letsencrypt/live/itnewhand.com/privkey.pem
</code></pre>
<blockquote>
<p>生成证书时要先停掉nginx</p>
</blockquote>

        <div class="copyright">Powered by <a href="https://github.com/jaywcjlove/idoc" target="_blank">idoc</a>. Dependence <a href="https://nodejs.org">Node.js</a> run.</div>
    </div>
    
</div>

<script src="https://cdn.bootcss.com/jquery/3.0.0/jquery.js"></script>
<script>
$('.warpper .page-toc ul ul li a').on('click',function(){
  $('.warpper .page-toc ul ul li a').removeClass('my-active')
  $(this).addClass('my-active')
})
  // if (!$('.understand-me').length) {
  //   var bar = $(window).height() - $('.navbar ').height() - $('.page-toc').position().top;
  //   var count = bar / 26 / 2;
  //   var barHeight = $('.page-toc').outerHeight();
  //   $('.page-toc li').eq(0).children('a').addClass('red');
  //   var arr = [];
  //   $("h1,h2,h3,h4,h5,h6").each(function () {
  //     arr.push($(this).position().top);
  //   });
  //   var timer
  //   function dark() {
  //     clearTimeout(timer)
  //      timer = setTimeout(function () {
  //      var top = Math.abs($('.page-toc > ul').position().top);
  //      var cur = $('.content').scrollTop();
  //      for (var i = arr.length; i >= 0; i--) {
  //        if (arr[i] <= cur) {
  //          break;
  //        }
  //      }
  //      if (i === -1) {
  //        i = 0;
  //      }
  //      $('.page-toc li a').removeClass('red');
  //      $('.page-toc li').eq(i).children('a').addClass('red');
  //      let height = $('.page-toc li').eq(i).position().top-$('.page-toc').height(); // 如果当前的offset出去了 回到中间可好？
  //      $('.page-toc').scrollTop(height+$('.page-toc').height()/2);
  //    },200)
  //   }

  //   $('.content').on('scroll', dark);
  // }
</script>
<style>

    /* ::-webkit-scrollbar{width:14px;}
    ::-webkit-scrollbar-track{background-color:transparent;}
    ::-webkit-scrollbar-thumb{background-color:transparent;}
    ::-webkit-scrollbar-thumb:hover {background-color:transparent}
    ::-webkit-scrollbar-thumb:active {background-color:transparent} */

    .page-toc > ul .red {
        background: #f3f3f3;
        z-index: 1;
        border-left: 3px solid #009a61;
        -webkit-transition: all .2s ease;
        transition: all .2s ease;
        color: #000
    }





</style>


</body></html>