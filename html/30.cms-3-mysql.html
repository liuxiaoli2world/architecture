<!DOCTYPE html><html lang="en"><head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>珠峰架构师成长计划</title>
    <link rel="stylesheet" type="text/css" href="../static/css/main.css">
</head>
<body>
<div class="nav">
    <div class="logo">
        
            珠峰架构师成长计划
        
    </div>
<ul><li><a href="../index.html">0.Async</a></li><li><a href="../html/0.editor.html">0.editor</a></li><li><a href="../html/0.module.html">0.module</a></li><li><a href="../html/1.ES2015.html">1.ES2015</a></li><li><a href="../html/2.Promise.html">2.Promise</a></li><li><a href="../html/3.Node.html">3.Node</a></li><li><a href="../html/4.NodeInstall.html">4.NodeInstall</a></li><li><a href="../html/5.REPL.html">5.REPL</a></li><li><a href="../html/6.NodeCore.html">6.NodeCore</a></li><li><a href="../html/7.module&amp;NPM.html">7.module&amp;NPM</a></li><li><a href="../html/8.Encoding.html">8.Encoding</a></li><li><a href="../html/9.Buffer.html">9.Buffer</a></li><li><a href="../html/10.fs.html">10.fs</a></li><li><a href="../html/11.Stream-1.html">11.Stream-1</a></li><li><a href="../html/11.Stream-2.html">11.Stream-2</a></li><li><a href="../html/11.Stream-3.html">11.Stream-3</a></li><li><a href="../html/11.Stream-4.html">11.Stream-4</a></li><li><a href="../html/12-Network-2.html">12-Network-2</a></li><li><a href="../html/12.NetWork-3.html">12.NetWork-3</a></li><li><a href="../html/12.Network-1.html">12.Network-1</a></li><li><a href="../html/13.tcp.html">13.tcp</a></li><li><a href="../html/14.http-1.html">14.http-1</a></li><li><a href="../html/14.http-2.html">14.http-2</a></li><li><a href="../html/15.compress.html">15.compress</a></li><li><a href="../html/16.crypto.html">16.crypto</a></li><li><a href="../html/17.process.html">17.process</a></li><li><a href="../html/18.yargs.html">18.yargs</a></li><li><a href="../html/19.cache.html">19.cache</a></li><li><a href="../html/20.action.html">20.action</a></li><li><a href="../html/21.https.html">21.https</a></li><li><a href="../html/22.cookie.html">22.cookie</a></li><li><a href="../html/23.session.html">23.session</a></li><li><a href="../html/24.express-1.html">24.express-1</a></li><li><a href="../html/24.express-2.html">24.express-2</a></li><li><a href="../html/24.express-3.html">24.express-3</a></li><li><a href="../html/24.express-4.html">24.express-4</a></li><li><a href="../html/25.koa-1.html">25.koa-1</a></li><li><a href="../html/26.webpack-1-basic.html">26.webpack-1-basic</a></li><li><a href="../html/26.webpack-2-optimize.html">26.webpack-2-optimize</a></li><li><a href="../html/26.webpack-3.tapable.html">26.webpack-3.tapable</a></li><li><a href="../html/26.webpack-4-AST.html">26.webpack-4-AST</a></li><li><a href="../html/26.webpack-5-source.html">26.webpack-5-source</a></li><li><a href="../html/26.webpack-6-loader.html">26.webpack-6-loader</a></li><li><a href="../html/26.webpack-7-plugin.html">26.webpack-7-plugin</a></li><li><a href="../html/26.webpack-8-hand.html">26.webpack-8-hand</a></li><li><a href="../html/27.react-1.html">27.react-1</a></li><li><a href="../html/27.react-2.html">27.react-2</a></li><li><a href="../html/27.react-3.html">27.react-3</a></li><li><a href="../html/27.react-4-immutable.html">27.react-4-immutable</a></li><li><a href="../html/27.react-5-react-dom-diff.html">27.react-5-react-dom-diff</a></li><li><a href="../html/27.react-6.html">27.react-6</a></li><li><a href="../html/28.react-mobx.html">28.react-mobx</a></li><li><a href="../html/28.redux-0.html">28.redux-0</a></li><li><a href="../html/28.redux-1.html">28.redux-1</a></li><li><a href="../html/28.redux-2-中间件.html">28.redux-2-中间件</a></li><li><a href="../html/28.redux-jwt-back.html">28.redux-jwt-back</a></li><li><a href="../html/28.redux-jwt-front.html">28.redux-jwt-front</a></li><li><a href="../html/29.mongodb-1.html">29.mongodb-1</a></li><li><a href="../html/29.mongodb-2.html">29.mongodb-2</a></li><li><a href="../html/29.mongodb-3.html">29.mongodb-3</a></li><li><a href="../html/29.mongodb-4.html">29.mongodb-4</a></li><li><a href="../html/29.mongodb-5.html">29.mongodb-5</a></li><li><a href="../html/29.mongodb-6.html">29.mongodb-6</a></li><li><a href="../html/30.cms-1-mysql.html">30.cms-1-mysql</a></li><li><a href="../html/30.cms-2-mysql.html">30.cms-2-mysql</a></li><li class="active"><a href="../html/30.cms-3-mysql.html">30.cms-3-mysql</a></li><li><a href="../html/30.cms-4-nunjucks.html">30.cms-4-nunjucks</a></li><li><a href="../html/30.cms-5-mock.html">30.cms-5-mock</a></li><li><a href="../html/30.cms-6-egg.html">30.cms-6-egg</a></li><li><a href="../html/30.cms-7-api.html">30.cms-7-api</a></li><li><a href="../html/30.cms-8-roadhog.html">30.cms-8-roadhog</a></li><li><a href="../html/30.cms-9-yaml.html">30.cms-9-yaml</a></li><li><a href="../html/30.cms-10-umi.html">30.cms-10-umi</a></li><li><a href="../html/30.cms-11-saga.html">30.cms-11-saga</a></li><li><a href="../html/30.cms-12-dva.html">30.cms-12-dva</a></li><li><a href="../html/30.cms-13-dva-ant.html">30.cms-13-dva-ant</a></li><li><a href="../html/30.cms-14-front.html">30.cms-14-front</a></li><li><a href="../html/30.cms-15-deploy.html">30.cms-15-deploy</a></li><li><a href="../html/31.dva.html">31.dva</a></li><li><a href="../html/33.redis.html">33.redis</a></li><li><a href="../html/34.unittest.html">34.unittest</a></li><li><a href="../html/35.jwt.html">35.jwt</a></li><li><a href="../html/36.websocket-1.html">36.websocket-1</a></li><li><a href="../html/36.websocket-2.html">36.websocket-2</a></li><li><a href="../html/38.chat-api-1.html">38.chat-api-1</a></li><li><a href="../html/38.chat-api-2.html">38.chat-api-2</a></li><li><a href="../html/38.chat-3.html">38.chat-3</a></li><li><a href="../html/38.chat-api-3.html">38.chat-api-3</a></li><li><a href="../html/38.chat.html">38.chat</a></li><li><a href="../html/38.chat2.html">38.chat2</a></li><li><a href="../html/38.chat2.html">38.chat2</a></li><li><a href="../html/39.crawl-0.html">39.crawl-0</a></li><li><a href="../html/39.crawl-1.html">39.crawl-1</a></li><li><a href="../html/39.crawl-2.html">39.crawl-2</a></li><li><a href="../html/40.deploy.html">40.deploy</a></li><li><a href="../html/41.safe.html">41.safe</a></li><li><a href="../html/42.test.html">42.test</a></li><li><a href="../html/43.nginx.html">43.nginx</a></li><li><a href="../html/44.enzyme.html">44.enzyme</a></li><li><a href="../html/45.docker.html">45.docker</a></li><li><a href="../html/46.elastic.html">46.elastic</a></li><li><a href="../html/47.oauth.html">47.oauth</a></li><li><a href="../html/48.wxpay.html">48.wxpay</a></li><li><a href="../html/index.html">index</a></li><li><a href="../html/51.typescript.html">51.typescript</a></li><li><a href="../html/52.UML.html">52.UML</a></li><li><a href="../html/53.design.html">53.design</a></li><li><a href="../html/index.html">index</a></li><li><a href="../html/54.linux.html">54.linux</a></li><li><a href="../html/57.ts.html">57.ts</a></li><li><a href="../html/56.react-ssr.html">56.react-ssr</a></li><li><a href="../html/58.ts_react.html">58.ts_react</a></li><li><a href="../html/59.ketang.html">59.ketang</a></li><li><a href="../html/59.ketang2.html">59.ketang2</a></li><li><a href="../html/31.saga.html">31.saga</a></li></ul></div>


<div class="warpper">

    <div class="page-toc">
        <ul><li><a href="#t01. 为什么需要设计数据库">1. 为什么需要设计数据库</a><ul><li><a href="#t11.1 良好的数据库设计">1.1 良好的数据库设计</a></li><li><a href="#t21.2 糟糕的数据库设计">1.2 糟糕的数据库设计</a></li></ul></li><li><a href="#t32. 软件项目开发周期中的数据库设计">2. 软件项目开发周期中的数据库设计</a></li><li><a href="#t43.设计数据库的步骤">3.设计数据库的步骤</a><ul><li><a href="#t53.1 收集信息">3.1 收集信息</a></li><li><a href="#t63.2 标示实体(Entity)">3.2 标示实体(Entity)</a></li><li><a href="#t73.3 标示实体的属性(Attribute)">3.3 标示实体的属性(Attribute)</a></li><li><a href="#t83.4 标示实体之间的关系(RelationShip)">3.4 标示实体之间的关系(RelationShip)</a></li></ul></li><li><a href="#t94. 数据库ER图">4. 数据库ER图</a><ul><li><a href="#t104.1 ER图的实体（entity）">4.1 ER图的实体（entity）</a></li><li><a href="#t114.2 ER图的属性（attribute）">4.2 ER图的属性（attribute）</a></li><li><a href="#t124.3 ER图的关系（relationship）">4.3 ER图的关系（relationship）</a></li><li><a href="#t134.4 ER图中关联关系">4.4 ER图中关联关系</a><ul><li><a href="#t144.4.1 1对1 (1:1)">4.4.1 1对1 (1:1)</a></li><li><a href="#t154.4.2 1对多（1:N）">4.4.2 1对多（1:N）</a></li><li><a href="#t164.4.3 多对多（M:N）">4.4.3 多对多（M:N）</a></li></ul></li></ul></li><li><a href="#t175. 数据库设计三大范式">5. 数据库设计三大范式</a><ul><li><a href="#t185.1 不合理的表设计">5.1 不合理的表设计</a></li><li><a href="#t195.2 三大范式">5.2 三大范式</a><ul><li><a href="#t205.2.1  第一范式（1NF）">5.2.1  第一范式（1NF）</a></li><li><a href="#t215.2.2 第二范式（2NF）">5.2.2 第二范式（2NF）</a></li><li><a href="#t225.2.3 第三范式（3NF）">5.2.3 第三范式（3NF）</a></li><li><a href="#t235.2.4 如何更好的区分三大范式">5.2.4 如何更好的区分三大范式</a></li></ul></li></ul></li><li><a href="#t245.RBAC">5.RBAC</a><ul><li><a href="#t255.1 安全原则">5.1 安全原则</a></li><li><a href="#t265.2 ER图">5.2 ER图</a></li><li><a href="#t275.2.1 用户表">5.2.1 用户表</a></li><li><a href="#t285.2.2 角色表">5.2.2 角色表</a></li><li><a href="#t295.2.3 资源表">5.2.3 资源表</a></li><li><a href="#t305.2.4 用户角色表">5.2.4 用户角色表</a></li><li><a href="#t315.2.5 角色资源">5.2.5 角色资源</a></li><li><a href="#t325.3 数据库脚本">5.3 数据库脚本</a></li></ul></li><li><a href="#t336.事务">6.事务</a><ul><li><a href="#t346.1 为什么需要事务">6.1 为什么需要事务</a></li><li><a href="#t356.2 什么是事务">6.2 什么是事务</a></li><li><a href="#t366.3 事务的特性">6.3 事务的特性</a></li><li><a href="#t376.4 如何创建事务">6.4 如何创建事务</a></li></ul></li><li><a href="#t387.在node中使用mysql">7.在node中使用mysql</a><ul><li><a href="#t397.1 使用mysql">7.1 使用mysql</a></li><li><a href="#t407.2 使用mysql连接池">7.2 使用mysql连接池</a></li><li><a href="#t417.3 使用mysql事务">7.3 使用mysql事务</a></li></ul></li></ul>
    </div>
    
    <div class="content markdown-body">
        <h2 id="t01. 为什么需要设计数据库">1. 为什么需要设计数据库 <a href="#t01. 为什么需要设计数据库"> # </a></h2>
<h3 id="t11.1 良好的数据库设计">1.1 良好的数据库设计 <a href="#t11.1 良好的数据库设计"> # </a></h3>
<ul>
<li>节省数据的存储空间</li>
<li>能够保证数据的完整性</li>
<li>方便进行数据库系统的开发</li>
</ul>
<h3 id="t21.2 糟糕的数据库设计">1.2 糟糕的数据库设计 <a href="#t21.2 糟糕的数据库设计"> # </a></h3>
<ul>
<li>数据冗余，存储空间浪费</li>
<li>内存空间浪费</li>
<li>数据和更新插入异常</li>
</ul>
<h2 id="t32. 软件项目开发周期中的数据库设计">2. 软件项目开发周期中的数据库设计 <a href="#t32. 软件项目开发周期中的数据库设计"> # </a></h2>
<ul>
<li>需求分析阶段: 分析客户的业务和数据处理需求</li>
<li>概要设计阶段： 设计数据库的E-R模型图，确认需求的正确和完整性</li>
<li>详细设计阶段： 应用三大范式审核数据库</li>
<li>代码编写阶段： 物理实现数据库，编码实现应用</li>
<li>软件测试阶段</li>
<li>安装部署</li>
</ul>
<blockquote>
<p>现实世界-&gt;信息世界-&gt;数据库模型图-&gt;数据库</p>
</blockquote>
<h2 id="t43.设计数据库的步骤">3.设计数据库的步骤 <a href="#t43.设计数据库的步骤"> # </a></h2>
<h3 id="t53.1 收集信息">3.1 收集信息 <a href="#t53.1 收集信息"> # </a></h3>
<p>与相关人员进行交流、访谈充分了解用户需求，理解数据库需要完成的任务</p>
<h3 id="t63.2 标示实体(Entity)">3.2 标示实体(Entity) <a href="#t63.2 标示实体(Entity)"> # </a></h3>
<p>标识数据库要管理的关键对象或者实体，实体一般是名词</p>
<h3 id="t73.3 标示实体的属性(Attribute)">3.3 标示实体的属性(Attribute) <a href="#t73.3 标示实体的属性(Attribute)"> # </a></h3>
<h3 id="t83.4 标示实体之间的关系(RelationShip)">3.4 标示实体之间的关系(RelationShip) <a href="#t83.4 标示实体之间的关系(RelationShip)"> # </a></h3>
<h2 id="t94. 数据库ER图">4. 数据库ER图 <a href="#t94. 数据库ER图"> # </a></h2>
<p>ER图：实体关系图，简记E-R图，是指以实体、关系、属性三个基本概念概括数据的基本结构，从而描述静态数据结构的概念模式
<img src="http://img.zhufengpeixun.cn/er.png" alt="er"></p>
<h3 id="t104.1 ER图的实体（entity）">4.1 ER图的实体（entity） <a href="#t104.1 ER图的实体（entity）"> # </a></h3>
<ul>
<li>ER图的实体（entity）即数据模型中的数据对象，例如人、学生、音乐都可以作为一个数据对象，用长方体来表示</li>
</ul>
<h3 id="t114.2 ER图的属性（attribute）">4.2 ER图的属性（attribute） <a href="#t114.2 ER图的属性（attribute）"> # </a></h3>
<ul>
<li>ER图的属性（attribute）即数据对象所具有的属性，例如学生具有姓名、学号、年级等属性，用椭圆形表示</li>
<li>属性分为唯一属性（ unique attribute）和非唯一属性</li>
<li>唯一属性指的是唯一可用来标识该实体实例或者成员的属性，用下划线表示，一般来讲实体都至少有一个唯一属性。</li>
</ul>
<h3 id="t124.3 ER图的关系（relationship）">4.3 ER图的关系（relationship） <a href="#t124.3 ER图的关系（relationship）"> # </a></h3>
<ul>
<li>ER图的关系（relationship）用来表现数据对象与数据对象之间的联系</li>
<li>例如学生的实体和成绩表的实体之间有一定的联系，每个学生都有自己的成绩表，这就是一种关系，关系用菱形来表示。</li>
</ul>
<h3 id="t134.4 ER图中关联关系">4.4 ER图中关联关系 <a href="#t134.4 ER图中关联关系"> # </a></h3>
<h4 id="t144.4.1 1对1 (1:1)">4.4.1 1对1 (1:1) <a href="#t144.4.1 1对1 (1:1)"> # </a></h4>
<p>1对1关系是指对于实体集A与实体集B，A中的每一个实体至多与B中一个实体有关系；反之，在实体集B中的每个实体至多与实体集A中一个实体有关系。</p>
<p><img src="http://img.zhufengpeixun.cn/onetoone.png" alt="er"></p>
<h4 id="t154.4.2 1对多（1:N）">4.4.2 1对多（1:N） <a href="#t154.4.2 1对多（1:N）"> # </a></h4>
<p>1对多关系是指实体集A与实体集B中至少有N(N&gt;0)个实体有关系；并且实体集B中每一个实体至多与实体集A中一个实体有关系。</p>
<p><img src="http://img.zhufengpeixun.cn/onetomany.png" alt="er"></p>
<h4 id="t164.4.3 多对多（M:N）">4.4.3 多对多（M:N） <a href="#t164.4.3 多对多（M:N）"> # </a></h4>
<p>多对多关系是指实体集A中的每一个实体与实体集B中至少有M(M&gt;0)个实体有关系，并且实体集B中的每一个实体与实体集A中的至少N（N&gt;0）个实体有关系。</p>
<p><img src="http://img.zhufengpeixun.cn/manytomany.png" alt="er"></p>
<h2 id="t175. 数据库设计三大范式">5. 数据库设计三大范式 <a href="#t175. 数据库设计三大范式"> # </a></h2>
<h3 id="t185.1 不合理的表设计">5.1 不合理的表设计 <a href="#t185.1 不合理的表设计"> # </a></h3>
<ul>
<li>信息重复</li>
<li>更新异常</li>
<li>插入异常</li>
<li>删除异常</li>
</ul>
<h3 id="t195.2 三大范式">5.2 三大范式 <a href="#t195.2 三大范式"> # </a></h3>
<h4 id="t205.2.1  第一范式（1NF）">5.2.1  第一范式（1NF） <a href="#t205.2.1  第一范式（1NF）"> # </a></h4>
<ul>
<li>数据表中的每一列（每个字段）必须是不可拆分的最小单元，也就是确保每一列的原子性；</li>
</ul>
<p><img src="http://img.zhufengpeixun.cn/firstpattern.png" alt="firstpattern"></p>
<h4 id="t215.2.2 第二范式（2NF）">5.2.2 第二范式（2NF） <a href="#t215.2.2 第二范式（2NF）"> # </a></h4>
<ul>
<li>满足1NF后，要求表中的所有列，都必须依赖于主键，而不能有任何一列与主键没有关系，也就是说一个表只描述一件事情；</li>
<li>订单表和订单明细
<img src="http://img.zhufengpeixun.cn/orderdetail.png" alt="orderdetail"></li>
</ul>
<h4 id="t225.2.3 第三范式（3NF）">5.2.3 第三范式（3NF） <a href="#t225.2.3 第三范式（3NF）"> # </a></h4>
<ul>
<li>必须先满足第二范式（2NF），要求：表中的每一列只与主键直接相关而不是间接相关，（表中的每一列只能依赖于主键）；</li>
</ul>
<p><img src="http://img.zhufengpeixun.cn/thirdpattern.png" alt="thirdpattern"></p>
<h4 id="t235.2.4 如何更好的区分三大范式">5.2.4 如何更好的区分三大范式 <a href="#t235.2.4 如何更好的区分三大范式"> # </a></h4>
<ul>
<li>第一范式和第二范式的区别在于有没有分出两张表,第二范式是说一张表中包含了所种不同的实体属性，那么要必须分成多张表</li>
<li>第三范式是要求已经分成了多张表，那么一张表中只能有另一张表中的id（主键），而不能有其他的任何信息（其他的信息一律用外键在另一表的主键看查询）。</li>
</ul>
<h2 id="t245.RBAC">5.RBAC <a href="#t245.RBAC"> # </a></h2>
<ul>
<li>基于角色的权限访问控制（Role-Based Access Control） </li>
<li>RBAC（Role-Based Access Control，基于角色的访问控制），就是用户通过角色与权限进行关联</li>
<li>简单地说，一个用户拥有若干角色，每一个角色拥有若干权限。这样，就构造成“用户-角色-权限-资源”的授权模型</li>
<li>在这种模型中，用户与角色之间，角色与权限之间，权限与资源之间一般是多对多的关系。</li>
<li>在RBAC中最重要的概念包括：用户(User)，角色(Role)，权限(Permission)，资源(Resource) <h3 id="t255.1 安全原则">5.1 安全原则 <a href="#t255.1 安全原则"> # </a></h3>
</li>
<li>最小权限原则之所以被RBAC所支持，是因为RBAC可以将其角色配置成其完成任务所需要的最小的权限集</li>
<li>责任分离原则可以通过调用相互独立互斥的角色来共同完成敏感的任务而体现，比如要求一个计帐员和财务管理员共参与同一过帐。</li>
<li>数据抽象可以通过权限的抽象来体现，如财务操作用借款、存款等抽象权限，而不用操作系统提供的典型的读、写、执行权限</li>
</ul>
<h3 id="t265.2 ER图">5.2 ER图 <a href="#t265.2 ER图"> # </a></h3>
<p><img src="http://img.zhufengpeixun.cn/cms-er.png" alt="er"></p>
<h3 id="t275.2.1 用户表">5.2.1 用户表 <a href="#t275.2.1 用户表"> # </a></h3>
<table>
<thead>
<tr>
<th style="text-align:left">字段</th>
<th style="text-align:left">字段名</th>
<th style="text-align:left">类型</th>
<th style="text-align:left">默认</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">id</td>
<td style="text-align:left">ID</td>
<td style="text-align:left">int(11)</td>
<td style="text-align:left"></td>
</tr>
<tr>
<td style="text-align:left">username</td>
<td style="text-align:left">用户名</td>
<td style="text-align:left">varchar(255)</td>
<td style="text-align:left"></td>
</tr>
<tr>
<td style="text-align:left">password</td>
<td style="text-align:left">密码</td>
<td style="text-align:left">varchar(255)</td>
<td style="text-align:left"></td>
</tr>
<tr>
<td style="text-align:left">email</td>
<td style="text-align:left">邮箱</td>
<td style="text-align:left">varchar(255)</td>
<td style="text-align:left"></td>
</tr>
<tr>
<td style="text-align:left">phone</td>
<td style="text-align:left">手机号</td>
<td style="text-align:left">varchar(255)</td>
<td style="text-align:left"></td>
</tr>
<tr>
<td style="text-align:left">gender</td>
<td style="text-align:left">性别</td>
<td style="text-align:left">tinyint</td>
<td style="text-align:left"></td>
</tr>
<tr>
<td style="text-align:left">birthday</td>
<td style="text-align:left">生日</td>
<td style="text-align:left">datetime</td>
<td style="text-align:left"></td>
</tr>
<tr>
<td style="text-align:left">addresss</td>
<td style="text-align:left">地址</td>
<td style="text-align:left">varchar(255)</td>
<td style="text-align:left"></td>
</tr>
<tr>
<td style="text-align:left">create_time</td>
<td style="text-align:left">创建时间</td>
<td style="text-align:left">datetime</td>
<td style="text-align:left">CURRENT_TIMESTAMP</td>
</tr>
<tr>
<td style="text-align:left">last_login</td>
<td style="text-align:left">上次登录时间</td>
<td style="text-align:left">datetime</td>
<td style="text-align:left"></td>
</tr>
<tr>
<td style="text-align:left">status</td>
<td style="text-align:left">状态</td>
<td style="text-align:left">tinyint</td>
<td style="text-align:left">1</td>
</tr>
</tbody>
</table>
<h3 id="t285.2.2 角色表">5.2.2 角色表 <a href="#t285.2.2 角色表"> # </a></h3>
<table>
<thead>
<tr>
<th style="text-align:left">字段</th>
<th style="text-align:left">字段名</th>
<th style="text-align:left">类型</th>
<th style="text-align:left">默认</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">id</td>
<td style="text-align:left">ID</td>
<td style="text-align:left">int(11)</td>
<td style="text-align:left"></td>
</tr>
<tr>
<td style="text-align:left">name</td>
<td style="text-align:left">名称</td>
<td style="text-align:left">varchar(255)</td>
<td style="text-align:left"></td>
</tr>
<tr>
<td style="text-align:left">create_time</td>
<td style="text-align:left">创建时间</td>
<td style="text-align:left">datetime</td>
<td style="text-align:left">CURRENT_TIMESTAMP</td>
</tr>
<tr>
<td style="text-align:left">status</td>
<td style="text-align:left">状态</td>
<td style="text-align:left">tinyint</td>
<td style="text-align:left">1</td>
</tr>
</tbody>
</table>
<h3 id="t295.2.3 资源表">5.2.3 资源表 <a href="#t295.2.3 资源表"> # </a></h3>
<table>
<thead>
<tr>
<th style="text-align:left">字段</th>
<th style="text-align:left">字段名</th>
<th style="text-align:left">类型</th>
<th style="text-align:left">默认</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">id</td>
<td style="text-align:left">ID</td>
<td style="text-align:left">int(11)</td>
<td style="text-align:left"></td>
<td></td>
</tr>
<tr>
<td style="text-align:left">name</td>
<td style="text-align:left">名称</td>
<td style="text-align:left">varchar(255)</td>
<td style="text-align:left"></td>
</tr>
<tr>
<td style="text-align:left">key</td>
<td style="text-align:left">路径</td>
<td style="text-align:left">varchar(255)</td>
<td style="text-align:left"></td>
</tr>
<tr>
<td style="text-align:left">create_time</td>
<td style="text-align:left">创建时间</td>
<td style="text-align:left">datetime</td>
<td style="text-align:left">CURRENT_TIMESTAMP</td>
</tr>
<tr>
<td style="text-align:left">status</td>
<td style="text-align:left">状态</td>
<td style="text-align:left">tinyint</td>
<td style="text-align:left">1</td>
</tr>
</tbody>
</table>
<h3 id="t305.2.4 用户角色表">5.2.4 用户角色表 <a href="#t305.2.4 用户角色表"> # </a></h3>
<table>
<thead>
<tr>
<th style="text-align:left">字段</th>
<th style="text-align:left">字段名</th>
<th style="text-align:left">类型</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">user_id</td>
<td style="text-align:left">用户ID</td>
<td style="text-align:left">int(11)</td>
</tr>
<tr>
<td style="text-align:left">role_id</td>
<td style="text-align:left">角色ID</td>
<td style="text-align:left">int(11)</td>
</tr>
</tbody>
</table>
<h3 id="t315.2.5 角色资源">5.2.5 角色资源 <a href="#t315.2.5 角色资源"> # </a></h3>
<table>
<thead>
<tr>
<th style="text-align:left">字段</th>
<th style="text-align:left">字段名</th>
<th style="text-align:left">类型</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">role_id</td>
<td style="text-align:left">角色ID</td>
<td style="text-align:left">int(11)</td>
</tr>
<tr>
<td style="text-align:left">resource_id</td>
<td style="text-align:left">资源ID</td>
<td style="text-align:left">int(11)</td>
</tr>
</tbody>
</table>
<h3 id="t325.3 数据库脚本">5.3 数据库脚本 <a href="#t325.3 数据库脚本"> # </a></h3>
<pre><code class="lang-sql"><span class="hljs-keyword">ALTER</span> <span class="hljs-keyword">TABLE</span> <span class="hljs-string">`categories`</span> <span class="hljs-keyword">DROP</span> <span class="hljs-keyword">FOREIGN</span> <span class="hljs-keyword">KEY</span> <span class="hljs-string">`fk_category_parent_id`</span>;
<span class="hljs-keyword">ALTER</span> <span class="hljs-keyword">TABLE</span> <span class="hljs-string">`articles`</span> <span class="hljs-keyword">DROP</span> <span class="hljs-keyword">FOREIGN</span> <span class="hljs-keyword">KEY</span> <span class="hljs-string">`fk_article_category_id`</span>;
<span class="hljs-keyword">ALTER</span> <span class="hljs-keyword">TABLE</span> <span class="hljs-string">`user_role`</span> <span class="hljs-keyword">DROP</span> <span class="hljs-keyword">FOREIGN</span> <span class="hljs-keyword">KEY</span> <span class="hljs-string">`fk_user_role_user_id`</span>;
<span class="hljs-keyword">ALTER</span> <span class="hljs-keyword">TABLE</span> <span class="hljs-string">`user_role`</span> <span class="hljs-keyword">DROP</span> <span class="hljs-keyword">FOREIGN</span> <span class="hljs-keyword">KEY</span> <span class="hljs-string">`fk_user_role_role_id`</span>;
<span class="hljs-keyword">ALTER</span> <span class="hljs-keyword">TABLE</span> <span class="hljs-string">`role_resource`</span> <span class="hljs-keyword">DROP</span> <span class="hljs-keyword">FOREIGN</span> <span class="hljs-keyword">KEY</span> <span class="hljs-string">`fk_role_resource_role_id`</span>;
<span class="hljs-keyword">ALTER</span> <span class="hljs-keyword">TABLE</span> <span class="hljs-string">`role_resource`</span> <span class="hljs-keyword">DROP</span> <span class="hljs-keyword">FOREIGN</span> <span class="hljs-keyword">KEY</span> <span class="hljs-string">`fk_role_resource_resource_id`</span>;

<span class="hljs-keyword">DROP</span> <span class="hljs-keyword">TABLE</span> <span class="hljs-string">`users`</span>;
<span class="hljs-keyword">DROP</span> <span class="hljs-keyword">TABLE</span> <span class="hljs-string">`carousels`</span>;
<span class="hljs-keyword">DROP</span> <span class="hljs-keyword">TABLE</span> <span class="hljs-string">`categories`</span>;
<span class="hljs-keyword">DROP</span> <span class="hljs-keyword">TABLE</span> <span class="hljs-string">`articles`</span>;
<span class="hljs-keyword">DROP</span> <span class="hljs-keyword">TABLE</span> <span class="hljs-string">`navigations`</span>;
<span class="hljs-keyword">DROP</span> <span class="hljs-keyword">TABLE</span> <span class="hljs-string">`links`</span>;
<span class="hljs-keyword">DROP</span> <span class="hljs-keyword">TABLE</span> <span class="hljs-string">`config`</span>;
<span class="hljs-keyword">DROP</span> <span class="hljs-keyword">TABLE</span> <span class="hljs-string">`roles`</span>;
<span class="hljs-keyword">DROP</span> <span class="hljs-keyword">TABLE</span> <span class="hljs-string">`user_role`</span>;
<span class="hljs-keyword">DROP</span> <span class="hljs-keyword">TABLE</span> <span class="hljs-string">`resources`</span>;
<span class="hljs-keyword">DROP</span> <span class="hljs-keyword">TABLE</span> <span class="hljs-string">`role_resource`</span>;

<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> <span class="hljs-string">`users`</span> (
<span class="hljs-string">`id`</span> <span class="hljs-built_in">int</span>(<span class="hljs-number">11</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span> AUTO_INCREMENT,
<span class="hljs-string">`username`</span> <span class="hljs-built_in">varchar</span>(<span class="hljs-number">255</span>) <span class="hljs-literal">NULL</span>,
<span class="hljs-string">`password`</span> <span class="hljs-built_in">varchar</span>(<span class="hljs-number">255</span>) <span class="hljs-literal">NULL</span>,
<span class="hljs-string">`last_login`</span> datetime <span class="hljs-literal">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">CURRENT_TIMESTAMP</span>,
<span class="hljs-string">`create_time`</span> datetime <span class="hljs-literal">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">CURRENT_TIMESTAMP</span>,
<span class="hljs-string">`status`</span> tinyint(<span class="hljs-number">255</span>) <span class="hljs-literal">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-number">1</span>,
<span class="hljs-string">`email`</span> <span class="hljs-built_in">varchar</span>(<span class="hljs-number">255</span>) <span class="hljs-literal">NULL</span>,
<span class="hljs-string">`phone`</span> <span class="hljs-built_in">varchar</span>(<span class="hljs-number">255</span>) <span class="hljs-literal">NULL</span>,
<span class="hljs-string">`gender`</span> tinyint(<span class="hljs-number">255</span>) <span class="hljs-literal">NULL</span>,
<span class="hljs-string">`birthday`</span> datetime <span class="hljs-literal">NULL</span>,
<span class="hljs-string">`address`</span> <span class="hljs-built_in">varchar</span>(<span class="hljs-number">255</span>) <span class="hljs-literal">NULL</span>,
PRIMARY <span class="hljs-keyword">KEY</span> (<span class="hljs-string">`id`</span>) 
);
<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> <span class="hljs-string">`carousels`</span> (
<span class="hljs-string">`id`</span> <span class="hljs-built_in">int</span>(<span class="hljs-number">11</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span> AUTO_INCREMENT,
<span class="hljs-string">`title`</span> <span class="hljs-built_in">varchar</span>(<span class="hljs-number">255</span>) <span class="hljs-literal">NULL</span>,
<span class="hljs-string">`url`</span> <span class="hljs-built_in">varchar</span>(<span class="hljs-number">255</span>) <span class="hljs-literal">NULL</span>,
<span class="hljs-string">`create_time`</span> datetime <span class="hljs-literal">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">CURRENT_TIMESTAMP</span>,
<span class="hljs-string">`status`</span> tinyint(<span class="hljs-number">255</span>) <span class="hljs-literal">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-number">1</span>,
PRIMARY <span class="hljs-keyword">KEY</span> (<span class="hljs-string">`id`</span>) 
);
<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> <span class="hljs-string">`categories`</span> (
<span class="hljs-string">`id`</span> <span class="hljs-built_in">int</span>(<span class="hljs-number">11</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span> AUTO_INCREMENT,
<span class="hljs-string">`title`</span> <span class="hljs-built_in">varchar</span>(<span class="hljs-number">255</span>) <span class="hljs-literal">NULL</span>,
<span class="hljs-string">`description`</span> <span class="hljs-built_in">varchar</span>(<span class="hljs-number">255</span>) <span class="hljs-literal">NULL</span>,
<span class="hljs-string">`keywords`</span> <span class="hljs-built_in">varchar</span>(<span class="hljs-number">255</span>) <span class="hljs-literal">NULL</span>,
<span class="hljs-string">`create_time`</span> datetime <span class="hljs-literal">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">CURRENT_TIMESTAMP</span>,
<span class="hljs-string">`status`</span> tinyint(<span class="hljs-number">255</span>) <span class="hljs-literal">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-number">1</span>,
<span class="hljs-string">`parent_id`</span> <span class="hljs-built_in">int</span>(<span class="hljs-number">11</span>) <span class="hljs-literal">NULL</span>,
PRIMARY <span class="hljs-keyword">KEY</span> (<span class="hljs-string">`id`</span>) 
);
<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> <span class="hljs-string">`articles`</span> (
<span class="hljs-string">`id`</span> <span class="hljs-built_in">int</span>(<span class="hljs-number">11</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span> AUTO_INCREMENT,
<span class="hljs-string">`category_id`</span> <span class="hljs-built_in">int</span>(<span class="hljs-number">11</span>) <span class="hljs-literal">NULL</span>,
<span class="hljs-string">`title`</span> <span class="hljs-built_in">varchar</span>(<span class="hljs-number">255</span>) <span class="hljs-literal">NULL</span>,
<span class="hljs-string">`content`</span> <span class="hljs-built_in">text</span> <span class="hljs-literal">NULL</span>,
<span class="hljs-string">`user_id`</span> <span class="hljs-built_in">int</span>(<span class="hljs-number">255</span>) <span class="hljs-literal">NULL</span>,
<span class="hljs-string">`keywords`</span> <span class="hljs-built_in">varchar</span>(<span class="hljs-number">255</span>) <span class="hljs-literal">NULL</span>,
<span class="hljs-string">`create_time`</span> datetime <span class="hljs-literal">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">CURRENT_TIMESTAMP</span>,
<span class="hljs-string">`status`</span> tinyint(<span class="hljs-number">255</span>) <span class="hljs-literal">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-number">1</span>,
<span class="hljs-string">`pv`</span> <span class="hljs-built_in">int</span>(<span class="hljs-number">255</span>) <span class="hljs-literal">NULL</span>,
PRIMARY <span class="hljs-keyword">KEY</span> (<span class="hljs-string">`id`</span>) 
);
<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> <span class="hljs-string">`navigations`</span> (
<span class="hljs-string">`id`</span> <span class="hljs-built_in">int</span>(<span class="hljs-number">11</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span> AUTO_INCREMENT,
<span class="hljs-string">`title`</span> <span class="hljs-built_in">varchar</span>(<span class="hljs-number">255</span>) <span class="hljs-literal">NULL</span>,
<span class="hljs-string">`url`</span> <span class="hljs-built_in">varchar</span>(<span class="hljs-number">255</span>) <span class="hljs-literal">NULL</span>,
<span class="hljs-string">`create_time`</span> datetime <span class="hljs-literal">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">CURRENT_TIMESTAMP</span>,
<span class="hljs-string">`status`</span> tinyint(<span class="hljs-number">255</span>) <span class="hljs-literal">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-number">1</span>,
PRIMARY <span class="hljs-keyword">KEY</span> (<span class="hljs-string">`id`</span>) 
);
<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> <span class="hljs-string">`links`</span> (
<span class="hljs-string">`id`</span> <span class="hljs-built_in">int</span>(<span class="hljs-number">11</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span> AUTO_INCREMENT,
<span class="hljs-string">`title`</span> <span class="hljs-built_in">varchar</span>(<span class="hljs-number">255</span>) <span class="hljs-literal">NULL</span>,
<span class="hljs-string">`logo`</span> <span class="hljs-built_in">varchar</span>(<span class="hljs-number">255</span>) <span class="hljs-literal">NULL</span>,
<span class="hljs-string">`url`</span> <span class="hljs-built_in">varchar</span>(<span class="hljs-number">255</span>) <span class="hljs-literal">NULL</span>,
<span class="hljs-string">`create_time`</span> datetime <span class="hljs-literal">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">CURRENT_TIMESTAMP</span>,
<span class="hljs-string">`status`</span> tinyint(<span class="hljs-number">255</span>) <span class="hljs-literal">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-number">1</span>,
PRIMARY <span class="hljs-keyword">KEY</span> (<span class="hljs-string">`id`</span>) 
);
<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> <span class="hljs-string">`config`</span> (
<span class="hljs-string">`id`</span> <span class="hljs-built_in">int</span>(<span class="hljs-number">11</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span> AUTO_INCREMENT,
<span class="hljs-string">`name`</span> <span class="hljs-built_in">varchar</span>(<span class="hljs-number">255</span>) <span class="hljs-literal">NULL</span>,
<span class="hljs-string">`logo`</span> <span class="hljs-built_in">varchar</span>(<span class="hljs-number">255</span>) <span class="hljs-literal">NULL</span>,
<span class="hljs-string">`url`</span> <span class="hljs-built_in">varchar</span>(<span class="hljs-number">255</span>) <span class="hljs-literal">NULL</span>,
<span class="hljs-string">`create_time`</span> datetime <span class="hljs-literal">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">CURRENT_TIMESTAMP</span>,
<span class="hljs-string">`status`</span> tinyint(<span class="hljs-number">255</span>) <span class="hljs-literal">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-number">1</span>,
<span class="hljs-string">`keywords`</span> <span class="hljs-built_in">varchar</span>(<span class="hljs-number">255</span>) <span class="hljs-literal">NULL</span>,
<span class="hljs-string">`description`</span> <span class="hljs-built_in">varchar</span>(<span class="hljs-number">255</span>) <span class="hljs-literal">NULL</span>,
<span class="hljs-string">`icp`</span> <span class="hljs-built_in">varchar</span>(<span class="hljs-number">255</span>) <span class="hljs-literal">NULL</span>,
<span class="hljs-string">`about`</span> <span class="hljs-built_in">varchar</span>(<span class="hljs-number">255</span>) <span class="hljs-literal">NULL</span>,
PRIMARY <span class="hljs-keyword">KEY</span> (<span class="hljs-string">`id`</span>) 
);
<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> <span class="hljs-string">`roles`</span> (
<span class="hljs-string">`id`</span> <span class="hljs-built_in">int</span>(<span class="hljs-number">11</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span> AUTO_INCREMENT,
<span class="hljs-string">`name`</span> <span class="hljs-built_in">varchar</span>(<span class="hljs-number">255</span>) <span class="hljs-literal">NULL</span>,
<span class="hljs-string">`create_time`</span> datetime <span class="hljs-literal">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">CURRENT_TIMESTAMP</span>,
<span class="hljs-string">`status`</span> tinyint(<span class="hljs-number">255</span>) <span class="hljs-literal">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-number">1</span>,
PRIMARY <span class="hljs-keyword">KEY</span> (<span class="hljs-string">`id`</span>) 
);
<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> <span class="hljs-string">`user_role`</span> (
<span class="hljs-string">`user_id`</span> <span class="hljs-built_in">int</span>(<span class="hljs-number">11</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span> AUTO_INCREMENT,
<span class="hljs-string">`role_id`</span> <span class="hljs-built_in">int</span>(<span class="hljs-number">255</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
PRIMARY <span class="hljs-keyword">KEY</span> (<span class="hljs-string">`user_id`</span>, <span class="hljs-string">`role_id`</span>) 
);
<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> <span class="hljs-string">`resources`</span> (
<span class="hljs-string">`id`</span> <span class="hljs-built_in">int</span>(<span class="hljs-number">11</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span> AUTO_INCREMENT,
<span class="hljs-string">`name`</span> <span class="hljs-built_in">varchar</span>(<span class="hljs-number">255</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
<span class="hljs-string">`key`</span> <span class="hljs-built_in">varchar</span>(<span class="hljs-number">255</span>) <span class="hljs-literal">NULL</span>,
<span class="hljs-string">`create_time`</span> datetime <span class="hljs-literal">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">CURRENT_TIMESTAMP</span>,
<span class="hljs-string">`status`</span> tinyint(<span class="hljs-number">255</span>) <span class="hljs-literal">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-number">1</span>,
PRIMARY <span class="hljs-keyword">KEY</span> (<span class="hljs-string">`id`</span>) 
);
<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> <span class="hljs-string">`role_resource`</span> (
<span class="hljs-string">`role_id`</span> <span class="hljs-built_in">int</span>(<span class="hljs-number">11</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span> AUTO_INCREMENT,
<span class="hljs-string">`resource_id`</span> <span class="hljs-built_in">int</span>(<span class="hljs-number">255</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
PRIMARY <span class="hljs-keyword">KEY</span> (<span class="hljs-string">`role_id`</span>, <span class="hljs-string">`resource_id`</span>) 
);

<span class="hljs-keyword">ALTER</span> <span class="hljs-keyword">TABLE</span> <span class="hljs-string">`categories`</span> <span class="hljs-keyword">ADD</span> <span class="hljs-keyword">CONSTRAINT</span> <span class="hljs-string">`fk_category_parent_id`</span> <span class="hljs-keyword">FOREIGN</span> <span class="hljs-keyword">KEY</span> (<span class="hljs-string">`parent_id`</span>) <span class="hljs-keyword">REFERENCES</span> <span class="hljs-string">`categories`</span> (<span class="hljs-string">`id`</span>);
<span class="hljs-keyword">ALTER</span> <span class="hljs-keyword">TABLE</span> <span class="hljs-string">`articles`</span> <span class="hljs-keyword">ADD</span> <span class="hljs-keyword">CONSTRAINT</span> <span class="hljs-string">`fk_article_category_id`</span> <span class="hljs-keyword">FOREIGN</span> <span class="hljs-keyword">KEY</span> (<span class="hljs-string">`category_id`</span>) <span class="hljs-keyword">REFERENCES</span> <span class="hljs-string">`categories`</span> (<span class="hljs-string">`id`</span>);
<span class="hljs-keyword">ALTER</span> <span class="hljs-keyword">TABLE</span> <span class="hljs-string">`user_role`</span> <span class="hljs-keyword">ADD</span> <span class="hljs-keyword">CONSTRAINT</span> <span class="hljs-string">`fk_user_role_user_id`</span> <span class="hljs-keyword">FOREIGN</span> <span class="hljs-keyword">KEY</span> (<span class="hljs-string">`user_id`</span>) <span class="hljs-keyword">REFERENCES</span> <span class="hljs-string">`users`</span> (<span class="hljs-string">`id`</span>);
<span class="hljs-keyword">ALTER</span> <span class="hljs-keyword">TABLE</span> <span class="hljs-string">`user_role`</span> <span class="hljs-keyword">ADD</span> <span class="hljs-keyword">CONSTRAINT</span> <span class="hljs-string">`fk_user_role_role_id`</span> <span class="hljs-keyword">FOREIGN</span> <span class="hljs-keyword">KEY</span> (<span class="hljs-string">`role_id`</span>) <span class="hljs-keyword">REFERENCES</span> <span class="hljs-string">`roles`</span> (<span class="hljs-string">`id`</span>);
<span class="hljs-keyword">ALTER</span> <span class="hljs-keyword">TABLE</span> <span class="hljs-string">`role_resource`</span> <span class="hljs-keyword">ADD</span> <span class="hljs-keyword">CONSTRAINT</span> <span class="hljs-string">`fk_role_resource_role_id`</span> <span class="hljs-keyword">FOREIGN</span> <span class="hljs-keyword">KEY</span> (<span class="hljs-string">`role_id`</span>) <span class="hljs-keyword">REFERENCES</span> <span class="hljs-string">`roles`</span> (<span class="hljs-string">`id`</span>);
<span class="hljs-keyword">ALTER</span> <span class="hljs-keyword">TABLE</span> <span class="hljs-string">`role_resource`</span> <span class="hljs-keyword">ADD</span> <span class="hljs-keyword">CONSTRAINT</span> <span class="hljs-string">`fk_role_resource_resource_id`</span> <span class="hljs-keyword">FOREIGN</span> <span class="hljs-keyword">KEY</span> (<span class="hljs-string">`resource_id`</span>) <span class="hljs-keyword">REFERENCES</span> <span class="hljs-string">`resources`</span> (<span class="hljs-string">`id`</span>);
</code></pre>
<h2 id="t336.事务">6.事务 <a href="#t336.事务"> # </a></h2>
<h3 id="t346.1 为什么需要事务">6.1 为什么需要事务 <a href="#t346.1 为什么需要事务"> # </a></h3>
<ul>
<li>银行转账问题</li>
<li>A账户资金减少</li>
<li>B账户资金增加</li>
</ul>
<pre><code class="lang-sql"><span class="hljs-keyword">create</span> <span class="hljs-keyword">database</span> bank;
<span class="hljs-keyword">use</span> bank;
<span class="hljs-keyword">create</span> <span class="hljs-keyword">table</span> <span class="hljs-keyword">account</span>
(
    <span class="hljs-keyword">name</span> <span class="hljs-built_in">varchar</span>(<span class="hljs-number">64</span>),
    balance <span class="hljs-built_in">decimal</span>(<span class="hljs-number">10</span>,<span class="hljs-number">2</span>)
)
<span class="hljs-keyword">insert</span> <span class="hljs-keyword">into</span> <span class="hljs-keyword">account</span>(<span class="hljs-keyword">name</span>,balance) <span class="hljs-keyword">values</span>(<span class="hljs-string">'张三'</span>,<span class="hljs-number">100</span>);
<span class="hljs-keyword">insert</span> <span class="hljs-keyword">into</span> <span class="hljs-keyword">account</span>(<span class="hljs-keyword">name</span>,balance) <span class="hljs-keyword">values</span>(<span class="hljs-string">'李四'</span>,<span class="hljs-number">100</span>);

<span class="hljs-keyword">update</span> <span class="hljs-keyword">account</span> <span class="hljs-keyword">set</span> balance = balance - <span class="hljs-number">10</span> <span class="hljs-keyword">where</span> <span class="hljs-keyword">name</span> = <span class="hljs-string">'张三'</span>;
<span class="hljs-keyword">update</span> <span class="hljs-keyword">account</span> <span class="hljs-keyword">set</span> balance = balance + <span class="hljs-number">10</span> <span class="hljs-keyword">where</span> <span class="hljs-keyword">name</span> = <span class="hljs-string">'李四'</span>;
</code></pre>
<h3 id="t356.2 什么是事务">6.2 什么是事务 <a href="#t356.2 什么是事务"> # </a></h3>
<ul>
<li>事务是作为单个逻辑工作单元执行的一系列操作</li>
<li>多个操作作为一个整体向系统提交，要么都执行，要么都不执行</li>
<li>事务是一个不可分割的工作逻辑单元</li>
</ul>
<blockquote>
<p>转账过程就是一个整体，它需要两条UPDATE语句，如果任何一个出错，则整个转账业务取消，两个账户的余额都恢复到原来的数据，确保总余额不变</p>
</blockquote>
<h3 id="t366.3 事务的特性">6.3 事务的特性 <a href="#t366.3 事务的特性"> # </a></h3>
<ul>
<li>原子性(Atomicity)  事务是一个完整的操作，事务各个部分是不可分的，要么都执行，要么都不执行</li>
<li>一致性(Consistency)  当事务完成后，数据必须处理完整的状态</li>
<li>隔离性(Isolation) 并发事务彼此隔离、独立，它不应该以任何方式依赖于其它事务</li>
<li>持久性(Durability) 事务完成后，它对数据库的修改被永久保持</li>
</ul>
<h3 id="t376.4 如何创建事务">6.4 如何创建事务 <a href="#t376.4 如何创建事务"> # </a></h3>
<ul>
<li>开始事务 <code>START TRANSACTION</code> 或者 <code>BEGIN</code></li>
<li>提交事务 <code>COMMIT</code></li>
<li>回滚或者说撤销事务 <code>ROLLBACK</code></li>
</ul>
<pre><code class="lang-sql"><span class="hljs-keyword">BEGIN</span>;
<span class="hljs-keyword">update</span> <span class="hljs-keyword">account</span> <span class="hljs-keyword">set</span> balance = balance - <span class="hljs-number">10</span> <span class="hljs-keyword">where</span> <span class="hljs-keyword">name</span> = <span class="hljs-string">'张三'</span>;
<span class="hljs-keyword">ROLLBACK</span>;
</code></pre>
<ul>
<li>默认情况下，每条单独的SQL语句视为一个事务</li>
<li>关闭默认提交状态后，可手动开启、关闭事务</li>
<li>关闭/开启自动提交状态 <code>SET autocommit 0|1</code> 0关闭 1开启</li>
</ul>
<blockquote>
<p>关闭自动提交后，从下一条SQL语句开始开启新的事务，需要使用COMMIT或ROLLBACK结束该事务</p>
</blockquote>
<h2 id="t387.在node中使用mysql">7.在node中使用mysql <a href="#t387.在node中使用mysql"> # </a></h2>
<ul>
<li><a href="https://www.npmjs.com/package/mysql">mysql</a></li>
</ul>
<pre><code class="lang-js">npm install mysql
</code></pre>
<h3 id="t397.1 使用mysql">7.1 使用mysql <a href="#t397.1 使用mysql"> # </a></h3>
<pre><code class="lang-js"><span class="hljs-keyword">var</span> mysql      = <span class="hljs-built_in">require</span>(<span class="hljs-string">'mysql'</span>);
<span class="hljs-keyword">var</span> connection = mysql.createConnection({
  <span class="hljs-attr">host</span>     : <span class="hljs-string">'localhost'</span>,
  <span class="hljs-attr">user</span>     : <span class="hljs-string">'me'</span>,
  <span class="hljs-attr">password</span> : <span class="hljs-string">'secret'</span>,
  <span class="hljs-attr">database</span> : <span class="hljs-string">'my_db'</span>
});

connection.connect();

connection.query(<span class="hljs-string">'SELECT 1 + 1 AS solution'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">error, results, fields</span>) </span>{
  <span class="hljs-keyword">if</span> (error) <span class="hljs-keyword">throw</span> error;
  <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'The solution is: '</span>, results[<span class="hljs-number">0</span>].solution);
});

connection.end();
</code></pre>
<h3 id="t407.2 使用mysql连接池">7.2 使用mysql连接池 <a href="#t407.2 使用mysql连接池"> # </a></h3>
<pre><code class="lang-js"><span class="hljs-keyword">var</span> mysql = <span class="hljs-built_in">require</span>(<span class="hljs-string">'mysql'</span>);
<span class="hljs-keyword">var</span> pool  = mysql.createPool({
  <span class="hljs-attr">connectionLimit</span> : <span class="hljs-number">10</span>,
  <span class="hljs-attr">host</span>            : <span class="hljs-string">'example.org'</span>,
  <span class="hljs-attr">user</span>            : <span class="hljs-string">'bob'</span>,
  <span class="hljs-attr">password</span>        : <span class="hljs-string">'secret'</span>,
  <span class="hljs-attr">database</span>        : <span class="hljs-string">'my_db'</span>
});

pool.query(<span class="hljs-string">'SELECT 1 + 1 AS solution'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">error, results, fields</span>) </span>{
  <span class="hljs-keyword">if</span> (error) <span class="hljs-keyword">throw</span> error;
  <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'The solution is: '</span>, results[<span class="hljs-number">0</span>].solution);
});
</code></pre>
<h3 id="t417.3 使用mysql事务">7.3 使用mysql事务 <a href="#t417.3 使用mysql事务"> # </a></h3>
<pre><code class="lang-js">connection.beginTransaction(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">err</span>) </span>{
  <span class="hljs-keyword">if</span> (err) { <span class="hljs-keyword">throw</span> err; }
  connection.query(<span class="hljs-string">'INSERT INTO posts SET title=?'</span>, title, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">error, results, fields</span>) </span>{
    <span class="hljs-keyword">if</span> (error) {
      <span class="hljs-keyword">return</span> connection.rollback(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
        <span class="hljs-keyword">throw</span> error;
      });
    }

    <span class="hljs-keyword">var</span> log = <span class="hljs-string">'Post '</span> + results.insertId + <span class="hljs-string">' added'</span>;

    connection.query(<span class="hljs-string">'INSERT INTO log SET data=?'</span>, log, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">error, results, fields</span>) </span>{
      <span class="hljs-keyword">if</span> (error) {
        <span class="hljs-keyword">return</span> connection.rollback(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
          <span class="hljs-keyword">throw</span> error;
        });
      }
      connection.commit(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">err</span>) </span>{
        <span class="hljs-keyword">if</span> (err) {
          <span class="hljs-keyword">return</span> connection.rollback(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
            <span class="hljs-keyword">throw</span> err;
          });
        }
        <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'success!'</span>);
      });
    });
  });
});
</code></pre>

        <div class="copyright">Powered by <a href="https://github.com/jaywcjlove/idoc" target="_blank">idoc</a>. Dependence <a href="https://nodejs.org">Node.js</a> run.</div>
    </div>
    
</div>

<script src="https://cdn.bootcss.com/jquery/3.0.0/jquery.js"></script>
<script>
$('.warpper .page-toc ul ul li a').on('click',function(){
  $('.warpper .page-toc ul ul li a').removeClass('my-active')
  $(this).addClass('my-active')
})
  // if (!$('.understand-me').length) {
  //   var bar = $(window).height() - $('.navbar ').height() - $('.page-toc').position().top;
  //   var count = bar / 26 / 2;
  //   var barHeight = $('.page-toc').outerHeight();
  //   $('.page-toc li').eq(0).children('a').addClass('red');
  //   var arr = [];
  //   $("h1,h2,h3,h4,h5,h6").each(function () {
  //     arr.push($(this).position().top);
  //   });
  //   var timer
  //   function dark() {
  //     clearTimeout(timer)
  //      timer = setTimeout(function () {
  //      var top = Math.abs($('.page-toc > ul').position().top);
  //      var cur = $('.content').scrollTop();
  //      for (var i = arr.length; i >= 0; i--) {
  //        if (arr[i] <= cur) {
  //          break;
  //        }
  //      }
  //      if (i === -1) {
  //        i = 0;
  //      }
  //      $('.page-toc li a').removeClass('red');
  //      $('.page-toc li').eq(i).children('a').addClass('red');
  //      let height = $('.page-toc li').eq(i).position().top-$('.page-toc').height(); // 如果当前的offset出去了 回到中间可好？
  //      $('.page-toc').scrollTop(height+$('.page-toc').height()/2);
  //    },200)
  //   }

  //   $('.content').on('scroll', dark);
  // }
</script>
<style>

    /* ::-webkit-scrollbar{width:14px;}
    ::-webkit-scrollbar-track{background-color:transparent;}
    ::-webkit-scrollbar-thumb{background-color:transparent;}
    ::-webkit-scrollbar-thumb:hover {background-color:transparent}
    ::-webkit-scrollbar-thumb:active {background-color:transparent} */

    .page-toc > ul .red {
        background: #f3f3f3;
        z-index: 1;
        border-left: 3px solid #009a61;
        -webkit-transition: all .2s ease;
        transition: all .2s ease;
        color: #000
    }





</style>


</body></html>